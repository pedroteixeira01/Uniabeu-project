<?php@session_start();require_once('classes/programacao.php');require_once('classes/util.php');function Processo($Processo) {    /* Atributos Globais */    $util = new Util();    $programacao = new Programacao();    /* Switch processos */    switch ($Processo) {        /* incluir */        case 'incluir':            $util->seguranca($_SESSION['idusuario'], 'index.php');            global $linha;            global $rs;                        $programacao->consultar('select c.idcolegio as idcolegio, c.descricao as descricaocol, p.descricao as descpais from colegio c INNER join pais p on(c.idpais=p.idpais) order by descpais,descricaocol');            $rs=$programacao->Result;            $linha=$programacao->Linha;            if (@$_POST['ok'] == 'true') {                try {                    //Chamar                                          $programacao->consultar('BEGIN');                    $programacao->incluir($util->formatoDataYMD($_POST['data_programacao']), $_POST['horario'], $_POST['tema'], $_POST['idcolegio']);                    $programacao->consultar('COMMIT');                    $util->msgbox('REGISTRO SALVO COM SUCESSO!');                   $util->redirecionamentopage('default.php?pg=' . base64_encode('visao/programacao/consulta.php') . '&titulo=' . base64_encode('Consulta de Programacao'));                } catch (Exception $ex) {                    $programacao->consultar('ROLLBACK');                    $util->msgbox('Falha de operacao');                }            }            break;        case 'consulta':            global $linha;            global $rs;            $programacao->consultar("select p.idprogramacao as idprogramacao, DATE_FORMAT(p.data_programacao,'%d/ %m/ %Y') as dataP, p.horario as horario, p.tema as tema, c.descricao as descricaocol, (CASE WEEKDAY(p.data_programacao)                        when 0 then 'Segunda-feira'                       when 1 then 'Terça-feira'                       when 2 then 'Quarta-feira'                       when 3 then 'Quinta-feira'                       when 4 then 'Sexta-feira'                       when 5 then 'Sábado'                       when 6 then 'Domingo'                                        END) AS DiaDaSemanafrom programacao p inner join colegio c ON(p.idcolegio=c.idcolegio) order by p.data_programacao desc");            $linha = $programacao->Linha;            $rs = $programacao->Result;            if (@$_POST['ok'] == 'true') {                $programacao->consultar("select *, DATE_FORMAT(data_programacao,'%d/ %m/ %Y') as dataP from programacao where tema like '%" . $_POST['descricao'] . "%' order by tema");                $linha = $programacao->Linha;                $rs = $programacao->Result;            }            break;        /* editar */        case 'editar':            $util->seguranca($_SESSION['idusuario'], 'index.php');            global $linha;            global $rs;                        global $linhaEditar;            global $rsEditar;                        $programacao->consultar('select c.idcolegio as idcolegio, c.descricao as descricaocol, p.descricao as descpais from colegio c INNER join pais p on(c.idpais=p.idpais) order by descpais,descricaocol');            $rs=$programacao->Result;            $linha=$programacao->Linha;            $programacao->consultar("select *, DATE_FORMAT(data_programacao,'%d/ %m/ %Y') as dataP from programacao where idprogramacao = " . $_GET['id']);            $linhaEditar = $programacao->Linha;            $rsEditar = $programacao->Result;            if (@$_POST['ok'] == 'true') {                try {                    $programacao->consultar('BEGIN');                    $programacao->alterar($_GET['id'],$util->formatoDataYMD($_POST['data_programacao']),$_POST['horario'], $_POST['tema'],$_POST['idcolegio']);                    $programacao->consultar('COMMIT');                    $util->msgbox('REGISTRO SALVO COM SUCESSO!');                    $util->redirecionamentopage('default.php?pg=' . base64_encode('visao/programacao/consulta.php') . '&titulo=' . base64_encode('Consulta de Programacao'));                } catch (Exception $ex) {                    $programacao->consultar('ROLLBACK');                    $util->msgbox('Falha de operacao');                }            }            break;    }}?>